# Files Service

This is the service that handles files for the fantastic drive.
It keeps files so that our users don't have to waste their precious hard drive in trivial things like medical records and tax forms.
Files are publicly accessible because we trust our users to be law-abiding citizens that don't have anything to hide.
However, we understand that there are some special cases, so we have a few files and paths inside the system that require VIP access.
The configuration for VIP access is loaded during service start up from a folder provided in an environment variables.
The current VIP configuration can be found in [/conf/vip](/conf/vip).

## Required infrastructure

The service requires a PostgreSQL database to run.

## Environment variables

To run the service, a bunch of environment variables are required:
- `VIP_CONFIG_PATH`: path to the folder that contains the VIP access configuration.
- `DB_HOST`: host for the PostgreSQL database.
- `DB_PORT`: port for the PostgreSQL database.
- `DB_USER`: username for the PostgreSQL database.
- `DB_PASS`: password for the PostgreSQL database.

## Plugins

### sbt-dependency-check

Checks for known vulnerabilities in Scala dependencies and generates a report file.
It can be run with the following command:

```bash
sbt dependencyCheck
```

### sbt-assembly

Generates a fat jar to deploy the service.

```bash
sbt assembly
```

## Logging

The location of the file `logback.xml` needs to be passed as a JVM argument when starting the service.
We need to be able to update the file without having to restart the service, that's why it isn't embedded in the produced jar. 

```bash
-Dlogback.configurationFile=conf/logback.xml
```

## API documentation

The API docs are autogenerated and can be accessed once the service is up and running in the path `/docs/service`.

All the endpoints related to the files expect a username to be present in the header `X-USER` so that we know which user is interacting with the system and can handle VIP access accordingly.

## Tests

The test suite can be run with the following command:

```bash
sbt test
```
